#Phython 
# Работа с файлами
### Подробное объяснение работы с файлами в Python

#### 1. Основы работы с файлами
**Открытие и закрытие файлов** - фундаментальная операция. Для работы с файлами используется функция `open()`.

```python
# Базовый синтаксис
file = open("filename.txt", "r")  # Открытие для чтения
content = file.read()
file.close()  # Важно закрывать файл!

# Контекстный менеджер (рекомендуемый способ)
with open("filename.txt", "r") as file:
    content = file.read()
# Файл автоматически закрывается после блока with
```

**Режимы открытия файлов:**
- `"r"` - чтение (по умолчанию)
- `"w"` - запись (перезаписывает существующий файл)
- `"a"` - дозапись в конец файла
- `"x"` - эксклюзивное создание (ошибка, если файл существует)
- `"b"` - бинарный режим
- `"+"` - чтение и запись

**Кодировки:**
- Важно указывать кодировку для текстовых файлов
- `encoding="utf-8"` - стандартная кодировка
- `encoding="cp1251"` - для кириллицы в Windows

```python
with open("file.txt", "r", encoding="utf-8") as file:
    # Работа с файлом
```

#### 2. Методы чтения файлов
**Чтение всего содержимого:**
```python
with open("example.txt", "r") as file:
    content = file.read()  # Читает весь файл как строку
```

**Чтение по строкам:**
```python
# Чтение одной строки
with open("example.txt", "r") as file:
    first_line = file.readline()
    second_line = file.readline()

# Чтение всех строк в список
with open("example.txt", "r") as file:
    lines = file.readlines()  # Возвращает список строк

# Итерация по строкам (эффективно для больших файлов)
with open("large_file.txt", "r") as file:
    for line in file:
        process(line)  # Обрабатываем каждую строку
```

**Чтение N символов:**
```python
with open("example.txt", "r") as file:
    chunk = file.read(100)  # Читает первые 100 символов
```

#### 3. Методы записи в файлы
**Запись строки:**
```python
with open("output.txt", "w") as file:
    file.write("Hello, World!\n")  # Запись строки
    file.write("Вторая строка\n")
```

**Запись нескольких строк:**
```python
lines = ["Первая строка\n", "Вторая строка\n", "Третья строка\n"]
with open("output.txt", "w") as file:
    file.writelines(lines)  # Записывает список строк
```

**Дозапись в файл:**
```python
with open("log.txt", "a") as file:
    file.write(f"[{datetime.now()}] Событие произошло\n")
```

#### 4. Позиционирование в файле
**Метод seek() и tell():**
```python
with open("data.bin", "rb") as file:
    position = file.tell()  # Текущая позиция (0)
    file.read(10)           # Читаем 10 байт
    position = file.tell()  # Теперь позиция 10
    file.seek(5)            # Перемещаемся на позицию 5
    file.seek(-3, 2)        # Перемещаемся на 3 байта с конца
```

#### 5. Работа с CSV файлами
Модуль `csv` предоставляет инструменты для работы с CSV.

**Чтение CSV:**
```python
import csv

# Чтение как списков
with open("data.csv", "r", newline="") as file:
    reader = csv.reader(file)
    for row in reader:
        print(row)  # Каждая строка - список

# Чтение как словарей
with open("data.csv", "r", newline="") as file:
    reader = csv.DictReader(file)
    for row in reader:
        print(row["name"], row["email"])  # Доступ по именам столбцов
```

**Запись CSV:**
```python
import csv

# Запись списков
data = [["Name", "Age"], ["Alice", 30], ["Bob", 25]]
with open("output.csv", "w", newline="") as file:
    writer = csv.writer(file)
    writer.writerows(data)

# Запись словарей
fieldnames = ["name", "email"]
data = [
    {"name": "Alice", "email": "alice@example.com"},
    {"name": "Bob", "email": "bob@example.com"}
]
with open("output.csv", "w", newline="") as file:
    writer = csv.DictWriter(file, fieldnames=fieldnames)
    writer.writeheader()  # Записываем заголовки
    writer.writerows(data)
```

#### 6. Работа с JSON
Модуль `json` позволяет работать с JSON данными.

**Чтение JSON:**
```python
import json

# Чтение из строки
data = json.loads('{"name": "Alice", "age": 30}')

# Чтение из файла
with open("data.json", "r") as file:
    data = json.load(file)
```

**Запись JSON:**
```python
import json

data = {
    "name": "Alice",
    "age": 30,
    "hobbies": ["reading", "hiking"]
}

# Запись в строку
json_string = json.dumps(data, indent=4)

# Запись в файл
with open("output.json", "w") as file:
    json.dump(data, file, indent=4, ensure_ascii=False)  # ensure_ascii=False для кириллицы
```

#### 7. Работа с бинарными файлами
Бинарные файлы открываются с режимом "b" (rb, wb, ab).

**Чтение бинарного файла:**
```python
with open("image.jpg", "rb") as file:
    header = file.read(10)  # Читаем первые 10 байт
    # Обработка бинарных данных
```

**Запись бинарного файла:**
```python
with open("copy.jpg", "wb") as file:
    with open("original.jpg", "rb") as source:
        while True:
            chunk = source.read(4096)  # Читаем блоками по 4KB
            if not chunk:
                break
            file.write(chunk)
```

#### 8. Обработка исключений при работе с файлами
```python
try:
    with open("missing_file.txt", "r") as file:
        content = file.read()
except FileNotFoundError:
    print("Файл не найден!")
except PermissionError:
    print("Нет прав доступа!")
except IOError as e:
    print(f"Ошибка ввода/вывода: {e}")
except Exception as e:
    print(f"Неизвестная ошибка: {e}")
```

### Домашнее задание (10 заданий)

**Задача 1: Анализатор логов**  
Напишите программу, которая читает файл логов и выводит:  
- Общее количество записей  
- Количество записей каждого уровня (INFO, WARNING, ERROR)  
- Самую частую ошибку

**Задача 2: Конвертер CSV в JSON**  
Создайте программу, которая конвертирует CSV файл в JSON формат.  
Аргументы: входной CSV, выходной JSON, разделитель (по умолчанию ",")

**Задача 3: Шифратор файлов**  
Реализуйте программу, которая шифрует/дешифрует файл с помощью XOR:  
`python file_crypt.py input.txt output.txt key`

**Задача 4: Поиск дубликатов**  
Напишите программу, которая находит дубликаты файлов в указанной директории (по содержимому).

**Задача 5: Резервное копирование**  
Создайте скрипт для инкрементного бэкапа:  
- Копирует только измененные файлы  
- Сохраняет версии с датой в имени  
- Ведет лог операций

**Задача 6: Анализатор текста**  
Программа должна:  
1. Принимать текстовый файл  
2. Подсчитывать статистику: количество слов, предложений, уникальных слов  
3. Сохранять результаты в CSV и JSON  
4. Создавать файл с 10 самыми частыми словами

**Задача 7: Парсер логов веб-сервера**  
Для файла в формате Nginx/Apache:  
- Извлекать IP-адреса  
- Подсчитывать количество запросов по статусам (200, 404, 500)  
- Определять самые популярные ресурсы

**Задача 8: Менеджер конфигураций**  
Создайте класс ConfigManager:  
- Чтение/запись конфигов в JSON, INI, YAML  
- Валидация схемы конфига  
- Возможность зашифровать конфиденциальные данные

**Задача 9: Слияние файлов**  
Программа объединяет несколько текстовых/CSV файлов в один:  
- Поддержка заголовков (для CSV)  
- Возможность указать порядок слияния  
- Фильтрация дубликатов

**Задача 10: Монитор изменений**  
Создайте программу, которая:  
1. Мониторит указанную директорию  
2. При изменении файла:  
   - Сохраняет предыдущую версию  
   - Логирует изменения  
   - Отправляет уведомление (в консоль/файл)

### Ресурсы для изучения
1. **[Официальная документация: работа с файлами](https://docs.python.org/3/tutorial/inputoutput.html#reading-and-writing-files)**
2. **[Модуль csv](https://docs.python.org/3/library/csv.html)**
3. **[Модуль json](https://docs.python.org/3/library/json.html)**
4. **[Real Python: File Handling](https://realpython.com/read-write-files-python/)**
5. **[Binary Files in Python](https://www.geeksforgeeks.org/working-with-binary-data-in-python/)**
6. **[Python File I/O: Exercises](https://www.w3resource.com/python-exercises/file/)**

### Пример решения задачи 1 (Анализатор логов)
```python
import re
from collections import defaultdict

def log_analyzer(log_file):
    log_levels = defaultdict(int)
    error_messages = defaultdict(int)
    total_entries = 0

    with open(log_file, "r", encoding="utf-8") as file:
        for line in file:
            total_entries += 1
            
            # Извлекаем уровень лога
            level_match = re.search(r"\[(INFO|WARNING|ERROR)\]", line)
            if level_match:
                level = level_match.group(1)
                log_levels[level] += 1
                
                # Считаем ошибки
                if level == "ERROR":
                    error_match = re.search(r"ERROR: (.+?)(?=\n|$)", line)
                    if error_match:
                        error_msg = error_match.group(1)
                        error_messages[error_msg] += 1
    
    # Находим самую частую ошибку
    most_common_error = max(error_messages.items(), key=lambda x: x[1], default=None)
    
    print(f"Всего записей: {total_entries}")
    print("Статистика по уровням:")
    for level, count in log_levels.items():
        print(f"  {level}: {count}")
    
    if most_common_error:
        print(f"Самая частая ошибка: '{most_common_error[0]}' ({most_common_error[1]} раз)")

# Использование
log_analyzer("app.log")
```

### Пример решения задачи 6 (Анализатор текста)
```python
import re
import json
import csv
from collections import Counter

def text_analyzer(input_file):
    with open(input_file, "r", encoding="utf-8") as file:
        text = file.read()
    
    # Удаляем знаки препинания
    cleaned_text = re.sub(r'[^\w\s]', '', text)
    
    # Разбиваем на слова
    words = cleaned_text.lower().split()
    word_count = len(words)
    
    # Подсчет уникальных слов
    unique_words = set(words)
    unique_count = len(unique_words)
    
    # Подсчет предложений
    sentences = re.split(r'[.!?]+', text)
    sentence_count = len([s for s in sentences if s.strip()])
    
    # 10 самых частых слов
    word_freq = Counter(words)
    top_words = word_freq.most_common(10)
    
    # Сохранение в CSV
    with open("text_stats.csv", "w", newline="", encoding="utf-8") as csv_file:
        writer = csv.writer(csv_file)
        writer.writerow(["Metric", "Value"])
        writer.writerow(["Total Words", word_count])
        writer.writerow(["Unique Words", unique_count])
        writer.writerow(["Sentences", sentence_count])
    
    # Сохранение в JSON
    with open("text_stats.json", "w", encoding="utf-8") as json_file:
        json.dump({
            "total_words": word_count,
            "unique_words": unique_count,
            "sentences": sentence_count,
            "top_words": [{"word": w, "count": c} for w, c in top_words]
        }, json_file, indent=4, ensure_ascii=False)
    
    # Сохранение топ-слов
    with open("top_words.txt", "w", encoding="utf-8") as txt_file:
        for word, count in top_words:
            txt_file.write(f"{word}: {count}\n")

# Использование
text_analyzer("book.txt")
```

### Пример решения задачи 10 (Монитор изменений)
```python
import os
import time
import hashlib
import shutil
from datetime import datetime

class FileMonitor:
    def __init__(self, directory):
        self.directory = directory
        self.snapshot = {}
        self.backup_dir = "backups"
        os.makedirs(self.backup_dir, exist_ok=True)
        
    def take_snapshot(self):
        """Создает снимок текущего состояния файлов"""
        new_snapshot = {}
        for root, _, files in os.walk(self.directory):
            for file in files:
                path = os.path.join(root, file)
                if os.path.isfile(path):
                    with open(path, "rb") as f:
                        file_hash = hashlib.md5(f.read()).hexdigest()
                    new_snapshot[path] = file_hash
        return new_snapshot
    
    def backup_file(self, file_path):
        """Создает резервную копию файла"""
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_path = os.path.join(
            self.backup_dir, 
            f"{os.path.basename(file_path)}_{timestamp}"
        )
        shutil.copy2(file_path, backup_path)
        return backup_path
    
    def log_change(self, message):
        """Логирует изменения"""
        with open("file_monitor.log", "a", encoding="utf-8") as log:
            timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            log.write(f"[{timestamp}] {message}\n")
    
    def start_monitoring(self, interval=10):
        """Запускает мониторинг с заданным интервалом"""
        self.log_change(f"Начало мониторинга директории: {self.directory}")
        self.snapshot = self.take_snapshot()
        
        try:
            while True:
                time.sleep(interval)
                new_snapshot = self.take_snapshot()
                
                # Проверка изменений
                for file_path, file_hash in new_snapshot.items():
                    if file_path not in self.snapshot:
                        backup = self.backup_file(file_path)
                        self.log_change(f"Создан новый файл: {file_path}. Резервная копия: {backup}")
                    elif self.snapshot[file_path] != file_hash:
                        backup = self.backup_file(file_path)
                        self.log_change(f"Файл изменен: {file_path}. Резервная копия: {backup}")
                
                # Проверка удаленных файлов
                for file_path in set(self.snapshot) - set(new_snapshot):
                    self.log_change(f"Файл удален: {file_path}")
                
                self.snapshot = new_snapshot
                
        except KeyboardInterrupt:
            self.log_change("Мониторинг остановлен пользователем")

# Использование
monitor = FileMonitor("important_docs")
monitor.start_monitoring()
```

Эти примеры демонстрируют практическое применение различных техник работы с файлами в Python. Каждое решение включает обработку ошибок, эффективную работу с данными и логирование операций.