#Технология_программирования 
26.02.2025
# Объектная модель Word
Часто при использовании инф система результат запроса бывает удобно подготовить в виде некоторого текстового документа с возможностью его распечатки, в таких случаях для вывода результата можно использовать возможности Word. Рассмотрим. Подготовка называют генерированием отчета. Как обычно, нужно подключить библиотеку и записать алиас вида `using Word = Micros`. Как обычно класс `application` является самой системой `Document` имеет тот же класс, что и `Workbook` также мы имеем коллекцию `Documents` и т.д. И все эти объекты имеют свойства и методы соответствующие Excel. 

Рассмотрим объекты для которых нет аналогов в Excel. Эти объекты связаны с отдельными составляющими документа. Заметим, что Word имеет достаточно широким функционалом, поэтому объекты модель включает в себя большое кол-во классов. Мы же ограничимся изучением классов для работы с текстами 

Объекты Word можно разделить на две группы:
1) Первая группа - позиционирование
2) Вторая группа - соответствует самому содержимому. Содержимое можно рассматривать, как последовательность следующих символов. Кроме обычных алфавитно-цифровых символов, могут быть спец символы соответствующие формулам, изображиний, а также невидимые символы. Эти последовательности символов представляют собой объекты типа `Range` можно получить доступ к текстовой составляющей эти символы `Text`. Заметим, что этот объект имеет тип `string`. Для работы с объектами типа `Range` можно использовать буфер обмен
	 `Copy() - копировать`
	 `Cut() - вырезать`
	 `Paste() - вставить`
	 `Bold - жирность`
	 `Italic - курсив`
	 `Font - с помощью него можно свойства Size Color Name`
```c#
Word.Range a, b, c, d;
a.Text = "Хорошо";
a.Copy();
b.Paste();
b.Font.Color = Word.WdColor.wdColorRed
b.Italic() = 2;
c.Delete();
```

Объекты типа `Range` может быть два типа:
1) Встроенные - создаются автоматически на основе конкретного документа любые изменения документа приводят к переопределению этого объекта
2) Определенные - определяется самим пользователем, достаточно произвольном варианте в любом количестве 



### Объекты определяющие структуру документа и встроенные объекты типа `Range`
Рассмотрим страницу Word, на ней можно определить 3 пространства:
1) Центральный - для текста
2) Верхний и нижний - для колонтитулов, если мы выбросим все колонтитулы, то в совокупностью образуют объект, который называется `Content` - это объект типа `Range`- все другие объекты, которые размещаются на странице, находятся в этом объекте, поэтому данный объект рассматривается, как свойство по умолчанию его написание при размещении других объектов можно размещать. С помощью `Content` можно изменять сразу весь текст
```c#
d.Content.Font.Size = 16;
```
Разделы являются экземпляры типа `Selection`. Раздел характеризуется линией разрыва. Первоначально в документе один раздел, можно добавить новые разделы с помощью `add()` обращение к разделу по его номеру `d.Selection[1]`. Объекты типа Range соответствуют типу данного раздела. 

Следующий уровень - это класса `Paragraph` экземпляры этого класса соответствуют экземплярам этого класса, также могут соответствовать строкам и ячейкам таблицы, а также концах, сколько таких символов - столько и абзацев. Первоначально в документе один экземпляр, он соответствует первому абзацу, добавить абзацы можно с помощью `add().Paragraph`. Заметим, что коллекция может соответствовать всему документу или некоторому разделу
```c#
d.Paragraph.add();
d.seetions[2].Range.Paragraph[3];
```
Для объектов типа Paragraph рассмотрим . При применении свойства Range. Свойство формат помогает форматировать данный абзац, например, устанавливать выравнивание - это можно сделать так `d.Paragraph[3].Format.Alignment = Word.WdParagraphAlignment.`

Внутри абзацев обычно находятся предложения. Коллекция предложений - Sentences, коллекция предложений может содержать предложения всего документа, или некоторого абзаца, обращение к определенному предложению по номеру:
```c#
d.Sentences[10].Text = "Плохо";
d.Sections[2].Range.Sentences[5].FontSize = 24;
d.Sections[3].Range.Paragraphs[7].Range.Sentences[3]
```
Заметим, что предложения сами явл сами объекта типа Range

Предложения состоят из слов, коллекция слов соответствует Words, к определенному слову можно определится по номеру. Под словом понимается совокупность символов

Пример: 
```c#
//создаем приложение Word и делаем его видимым 
Word.Application appW = new Word.Application(); 
appW.Visible = true;

//создаем новый документ Word 
Word.Document d = appW.Documents.Add();

//Добавляем заголовок в первый абзац (он существует), для этого устанавливаем в абзаце выравнивание по центру 
d.Paragraphs[1].Format.Alignment = Word.WdParagraphAlignment.wdAlignParagraphCenter;

//диапазон абзаца обозначаем через r 
Word.Range r = d.Paragraphs[1].Range;

//вводим текст заголовка 
r.Text = "Список";

//устанавливаем размер шрифта 
r.Font.Size = 16; 

//устанавливаем стиль, при котором написание строчных букв 
//будет аналогичен написанию прописных букв 
r.Font.SmallCaps = 1; 

//устанавливаем жирный шрифт 
r.Bold = 1; 

//устанавливаем подчеркивание одинарной линией 
r.Underline = Word.WdUnderline.wdUnderlineSingle; 

//выбираем шрифт Calibri 
r.Font.Name = "Calibri";

//оставляем пустую строку после заголовка 
d.Paragraphs.Add(); 
d.Paragraphs[2].Format.Alignment = Word.WdParagraphAlignment.wdAlignParagraphLeft; 
d.Paragraphs[2].Range.Text = "";

//создаем приложение Excel и делаем его видимым 
Excel.Application appE = new Excel.Application(); appE.Visible = true; 
//открываем книгу 
Excel.Workbook wb = appE.Workbooks.Open(@"c:\практика\итоги_сессии.xlsm" ); //ВЫЧИСЛЯЕМ СРЕДНИЕ БАЛЛЫ СТУДЕНТОВ И //ЗАПОЛНЯЕМ ДОКУМЕНТ Word, ДЛЯ ЭТОГО //фиксируем строку в таблице 
Excel int i = 2; 
string s; 
while (wb.Worksheets[1].Cells[i, 1].Value != null)
{ 
	//добавляем новый абзац в документ и выполняем установки 
	d.Paragraphs.Add(); 
	d.Paragraphs[i+1].Format.Alignment =           Word.WdParagraphAlignment.wdAlignParagraphLeft; 
	r = d.Paragraphs[i+1].Range; 
	r.Italic = 1; 
	r.Font.SmallCaps = 0; 
	r.Underline = Word.WdUnderline.wdUnderlineNone; 
	r.Font.Size = 14; 
	r.Bold = 0; r.Font.Name = "Times New Roman"; 
	//вычисляем средний балл студента и 
	//добавляем в новый абзац double 
	su = 0; 
	for (int j = 2; j < 5; j++)
		su += (float)wb.Worksheets[1].Cells[i, j].Value; 
		su /= 3.0; 
		su = Math.Round(su, 2); 
		s = wb.Worksheets[1].Cells[i, 1].Value + "" + r.Text = s;
		i++; 
}

//закрываем книгу 
wb.Close(); 
//завершаем работу 
Excel appE.Quit(); 
//сохраняем документ Word и закрываем его 
d.SaveAs(@"c:\практика\средний_балл.docx"); 
d.Close(); 
//завершаем работу 
Word appW.Quit();
```