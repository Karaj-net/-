#Технология_программирования 
16.04.2025
# Использование БД в WEB-приложениях
## Модель ADO.Net
Когда мы изучали Windows приложения мы рассматривали объекты моделей разных приложений в частности Word Excel and PowerPoint. Все эти приложения можно использовать и WEB-приложениях

Однако другая ситуация с БД. Дело в том, что мы использовали модель ADO основным объект recordset он относится в оперативной памяти и связан с некоторой таблицей БД, которая находится на диске. В данном случае у нас используется оперативная память дисков это бывает эффективно, если они оба относятся к одному компьютеру, данный вариант хорошо подходит для windows приложений, так как в них используется локальная БД, которая находится на одном устройстве. Другая ситуация с WEB-приложениями, с ней также можно использовать ADOBD, но обычно БД находится на другом устройстве. Поддерживание такой связи требует больших ресурсов, поэтому для WEB-приложений разработана другая модель ADO.Net. Некоторые элементы этой модели аналогичны модели ADOBD, но здесь используется несколько другие принципы. Таким образом, ADO.Net принципиально другая модель. Как и другая модель - эта модель оформлена в виде нескольких классов

Все объекты можно разделить на две группы:
1) Подсоединенные объекты - эти объекты непосредственно взаимодействуют с БД. Главным классом является `connection`, `Command`, `DataReader`
2) Отсоединенные объекты, здесь основным классом является - `DataSet`, `DataTable`,. Эти классы извлечены из БД, то есть находятся в ОП

Дело в том, что данные могут хранится в разных хранилищах . Есть классы, которые работают с некоторым конкретным типом БД, например, MsSQL. В данном случае поставщик называется SQL существуют поставщики классы, которых способны для обработки, достаточно широкого типа БД. В данном случае можно использовать данные Acces, мы их и будем использовать

Классы каждого поставщика обьеденяются в объедененное. Наше пространство будет называться `System.Data.Oledb` , также можно добавить аллиас. Классы соответствующие объедененным классам имеют прфикс соот. поставщика

## Соединение с БД
При использовании модели ADO обычно соединение делали с помощью
`Connection cnn = new Connection();
cnn.Open(...);`
Также мы можем также поступать с ADO, но это не эффективно, потому что требует больших ресурсов, нужно, как можно позже открывать и как можно раньше закрывать 

Переменную описывают на уровне класса, получается поле, в этом случае она будет видна во всех процедурах, создание соединения выполняется процедурой соответствующей загрузке страницы, в этом случае у нас при загрузке страницы будет создано соединение, в этой процедуре записывается оператор создающий экземпляры и устанавливается строка соединения. Это делается непосредственно во время работы. С открытием БД могут быть проблемы, поэтому этот оператор должен находится в охраняемом блоке. Оператор разрывающий соединение находится в финальном блоке 

У клиента не будет способа поменять имя БД для этого используется файл web.config это фактически файл html. Чтобы прописать и добавить элемент
```.Net
<connectionStrings>
<add name = "cs1" connectionString = "...">
</connectionStrings>
```
После этого можем записать 
```c#
System.Web.Configuration.WebConfigurationMessage;
Connection cnn = new Connection();
cnn.ConnectionString = System.Web;
Connection.WebConnectionManeger;
Connecton.WebConnectionManager.ConnectionStrings["cs1"].ConnectionString;
```
```c#
class...
{
	OledbConnection cnn;
	void Page_Load()
	{
		cnn = new OledbConnection();
		cnn.ConnectionString = Connection cnn = new Connection();
								cnn.ConnectionString = System.Web.Configuration;
								Connection.ConfigurationManeger;
		Connecton.WebConnectionManager.ConnectionStrings["cs1"].ConnectionString;
	}
	void Click_Button()
	{
		try
		{
			cnn.Open();
		}
		Catch(Exceptiion ex)
		{
			Label1.Text = string.Format("Ошибка {0}</bz>"ex.messege);
		}
		finelly
		{
			cnn.Close();
		}
	}
}
```

## Создание команд
Первую команду мы создадим для вывода некоторой БД на страницу web-страницу. На странице разместим Button1, Label1, GridView1(для вывода данных БД). 

Команды являются классом системы OledbCommand перед созданием команды нужно описать команду, второе, создать экземпляр при помощи конструкции, установить соединение, установить тип команды, установить текст команды. Где инструкция будет соответствовать инструкции SQL. Существуют команды других типов, например, для хранимых процедур - это фрагменты кода на SQL в виде программы. Заметим, что текстовый тип является по умолчанию, поэтому мы можем все указанные действия записать в одном операторе, в котором соединение и текст команды передать в виде параметров конструкторов, соот. оператор будет иметь вид:
```c#
OledbConnection cmd1 = new OledbCommand("Select *fromTable1", cnn); 
```
После создания команды ее нужно выполнить, для этого нужно использовать `ExecuteReader` или `ExecuteNonQnew` первый метод непосредственно работает с данными и после исполнения возвращает `DataReader`, содержащий данные из БД. Второй метод работает с записями в БД и возвращает кол-во обработанных записей, в наем случае нужно использовать первый метод. Код может иметь вид:
```c#
void Button1_Click()
{
	true
	{
		OledbConnection cmd1 = new OledbCommand("Select *fromTable1", cnn);
		cnn.Open();
		DataReader dz = cmd1.ExecuteReader();
		GridView1.DataSource = dz;
		GridView1.DataBild();
	}
	finelly
	{
		cnn.Close();
	}
}
```